\section{Partial trace and open systems}
\label{sec:p_tr}

In a bipartite system, one subsystem considered alone is an
\emph{open quantum system},
while the system as a whole is still a closed systems.

In this and the following sections, unless differently noted,
we shall stick with the convention of \eqref{eq:bipartite_expansion},
of using
Latin indices for subsystem $A$ and Greek ones for subsystem $B$.

Now, let's consider an observable $M_A$, acting only on subsystems $A$.
It can be expressed in $\hilb{H}_A \otimes \hilb{H}_B$ as
\[
  M_A \otimes \idop_B\, .
\]
Its expectation value is
(using the expansion in eq. \eqref{eq:bipartite_expansion},
and the notation of Latin indices for system $A$ and Greek ones for system $B$)
\begin{multline}\label{eq:exp_subsys}
  \expval{M_A} = \matrixel{\psi_S}{M_A\otimes\idop_B}{\psi_S} = \\[1em]
  \sum_{j,\nu}a^{*}_{j\nu}\left(\bra{j}\otimes\bra{\nu}\right)\left(M_A\otimes\idop_B\right)\sum_{i,\mu}a_{i\mu}\left(\ket{i}\otimes\ket{\mu}\right) = \\
  \sum_{j,\nu,i,\mu}a^{*}_{j\nu}a_{i\mu}\matrixel{j}{M}{i}\matrixel{\mu}{\idop}{\nu} =
  \sum_{j,\mu,i}a^{*}_{j\mu}a_{i\mu}\matrixel{j}{M}{i}
\end{multline}

The bra $\bra{\mu}$, when acting on a ket element of $\hilb{H}_{A} \ox \hilb{H}_{B}$,
can be defined
as a map from $\hilb{H}_A\otimes\hilb{H}_B$ to $\hilb{H}_A$.

A formal definition can be given in terms of how it acts upon a generic
basis ket of $\hilb{H}_A\otimes\hilb{H}_B$.

\begin{definition}\label{def:pBra}
\[
  \braket{\mu}{i\nu} = \bra{\mu}\Big(\ket{i}\otimes\ket{\nu}\Big) \eqbydef \delta_{\mu\nu}\ket{i} \text{.}
\]
\end{definition}

Intuitively, $\bra{\mu}$ is then a ``partial bra''
as it only maps the ``$\ket{\nu}$'' part of\\
``$\ket{i}\otimes\ket{\nu}$''
to a number:
\[
  \begin{array}{cccc}
    \bra{\mu}:  & \ket{i}\ox\ket{\nu}                   & \rightarrow & \delta_{\mu\nu}\ket{i}                \\
                & \rotatebox[origin=c]{270}{$\in$}      &             & \rotatebox[origin=c]{270}{$\in$}      \\
                & \hilb{H}_A\ox\hilb{H}_B               &             & \hilb{H}_A   \text{.}
  \end{array}
\]

This is consistent with the idea of
``tracing out the environment'' within an interpretation where
$\hilb{H}_B$ is the environment, and ultimately with the goal of
studying subsystem $A$ alone in spite of its entanglement with the 
``environment'' (or measurement apparatus etc.) modelled by
subsystem $B$.

Conversely,
the ket $\ket{\mu}$, when acting on a bra element of $\hilb{H}_{A} \ox \hilb{H}_{B}$,
can also be defined
as a map from $\hilb{H}_A\otimes\hilb{H}_B$ to $\hilb{H}_A$.
The following definition of $\ket{\mu}$ is simply \term{dual} to Definition \ref{def:pBra}:
\begin{definition}\label{def:pKet}
  \[
    \braket{i\nu}{\mu} = \Big(\bra{i}\ox\bra{\nu}\Big)\ket{\mu} \eqbydef \delta_{\mu\nu}\bra{i} \text{.}
  \]
\end{definition}
Similar considerations apply:
\[
  \begin{array}{cccc}
    \ket{\mu}:  & \bra{i}\ox\bra{\nu}                   & \rightarrow & \delta_{\mu\nu}\bra{i}               \\
                & \rotatebox[origin=c]{270}{$\in$}      &             & \rotatebox[origin=c]{270}{$\in$}      \\
                & \hilb{H}_A\ox\hilb{H}_B               &             & \hilb{H}_A     \text{.}
  \end{array}
\]

%%

We are now in the position to introduce the \term{partial trace}:
\begin{definition}\label{def:pTr}
  If $\setof{\ket{\mu}}$ is a basis of $\hilb{H}_B$,
  the \term{partial trace}
  is a linear map
  that takes an operator
  $M_{AB}$ on $\hilb{H}_A \otimes \hilb{H}_B$
  to an operator on $\hilb{H}_A$ defined as
  \[
    \tr_B M_{AB} = \sum_{\mu} \matrixel{\mu}{M_{AB}}{\mu}
    \, \text{.}
  \]
\end{definition}

The first thing to note is that the \emph{partial} trace is \emph{operator-valued},
its value is not a scalar as opposed to the \emph{trace}.

Next, we can introduce the \term{reduced density operator}
of system $A$, which is obtained by \emph{tracing out the environment} B,
via the partial trace:
\begin{definition}\label{def:density_A}
  If $\rho$ is the density operator of a whole bipartite system, composed of two parts $A$ and $B$,
  the \term{reduced density operator} related to subsystem $A$ is defined as
  \[
    \rho_A = \tr_B(\rho) \, \text{.}
  \]
\end{definition}

Using the definitions \ref{def:pBra} and \ref{def:pKet}
and the expansion \eqref{eq:bipartite_expansion}, we obtain
\begin{eqsplit}\label{eq:psiPartial}
  \braket{\mu}{\psi_S} &= \sum_i \alpha_{i\mu}    \ket{i} \\
  \braket{\psi_S}{\mu} &= \sum_j \alpha_{j\mu}^{*}\bra{j} \ \text{.}
\end{eqsplit}

which allows us to expand the Definition \ref{def:density_A}
as\footnote{
  Let's recall that the key point of this reasoning is showing how
  a pure state of the total system can correspond to mixed states
  in the two subsystems $A$ and $B$. Therefore, assuming, in what follows,
  that the total state $\rho = \ketbra{\psi}$ is pure, is not restrictive.
}

\begin{equation}\label{eq:density_A_expand}
  \rho_A = \tr_B(\ketbra{\psi_S}{\psi_S}) =
    \sum_{\mu}\braket{\mu}{\psi_S}\braket{\psi_S}{\mu} =
    \sum_{ij\mu} \alpha_{i\mu}\alpha_{j\mu}^{*}\ketbra{i}{j} \text{.}
\end{equation}

Finally, we can see that
\begin{multline*}
  \tr(M_A \rho_A) = \sum_k \mel{k}{M_A \rho_A}{k} =
    \sum_k \mel {k} {M_A \left(\sum_{ij\mu} \alpha_{i\mu}\alpha_{j\mu}^{*}\ketbra{i}{j}\right)} {k} = \\
    \sum_{ijk\mu} \alpha_{i\mu}\alpha_{j\mu}^{*} \mel{k}{M_A}{i} \braket{j}{k} =
    \sum_{ij\mu} \alpha_{i\mu}\alpha_{j\mu}^{*} \mel{j}{M_A}{i}
    \, \text{,}
\end{multline*}
which is the same result as \eqref{eq:exp_subsys}.

This allows us to conclude that
\begin{proposition}
  For an observable $M_A$, acting solely on one subsystem, the expectation value
  for state $\rho$ is given by
  \begin{equation}
    \expval{M_A} = \tr(M_A \rho_A)
  \end{equation}
  where $\rho_A$ is the reduced density operator obtained from $\rho$ by
  tracing out the environment $B$ (as per Definition \ref{def:density_A}).
\end{proposition}

It's clear from \eqref{eq:density_A_expand} that $\rho_A$ is self-adjoint,
hence it can be diagonalized:
\begin{equation}\label{eq:rho_diag}
  \rho_A = \sum_a p_a \ketbra{a}{a} \text{.}
\end{equation}

From \eqref{eq:density_A_expand} we can also derive that
\begin{equation}
  \tr\rho_A = \sum_k \mel{k}{\rho_A}{k} =
    \sum_{ijk\mu}\alpha_{i\mu}\alpha_{j\mu}^{*}\braket{k}{i}\braket{j}{k} =
    \sum_{k\mu}\abs{\alpha_{k\mu}}^2 = 1
\end{equation}
where the last equality is justified by the normalization of $\ket{\psi_S}$
in \eqref{eq:bipartite_expansion}.

The trace, i.e. the sum of matrix diagonal elements, is independent
from the chosen basis, hence $\tr\rho_A = 1$ is valid in particular
for the diagonal form \eqref{eq:rho_diag}, meaning
\[
  \sum_a p_a = 1
\]
and providing a necessary condition to interpret $p_a$ as a probability.

The \eqref{eq:rho_diag}, with $p_a$ as a probability, is often
given as a \emph{definition} of the density operator,
and the \eqref{eq:exp_subsys} can be derived from
such definition alone \parencite{open_systems}.
% TODO: do the calculation?
The probability distribution ${p_a}$
is described as an uncertainty in the preparation of the system
due to an unknown interaction with the environment.

We have seen that a bipartite system, as a whole in a pure state,
can have individual parts in mixed states, due to entanglement between them.

The reverse also holds true:
\begin{proposition}
A system with uncertainties in the preparation of the \emph{state}
(``mixed'') is equivalent to one part (``$A$'') of a bipartite system
entangled with the rest (``B'') such that the total system
$A+B$ is in a pure state.
\end{proposition}

The above is called \term{purification} (see e.g. \cite[sec.2.5]{NielsenChuang}).

